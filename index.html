<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>NOVA ARK ìš´ì˜ì‹œìŠ¤í…œ</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#f0f7f4;--bg2:#ffffff;--bg3:#e8f5e9;--border:#c8e6c9;--border2:#a5d6a7;
  --text:#1b4332;--text2:#52796f;--text3:#74a892;
  --primary:#2d6a4f;--primary-light:#40916c;--primary-dark:#1b4332;
  --accent:#95d5b2;--accent2:#b7e4c7;--green:#2d6a4f;--green-light:#52b788;
  --red:#c1121f;--yellow:#fb8500;--blue:#0077b6;--purple:#7b2cbf;
}
body{font-family:'Segoe UI',-apple-system,BlinkMacSystemFont,sans-serif;background:linear-gradient(135deg,#f0f7f4 0%,#e8f5e9 50%,#d8f3dc 100%);color:var(--text);font-size:16px;min-height:100vh}
.app{display:flex;min-height:100vh}
.sidebar{width:260px;background:linear-gradient(180deg,#1b4332 0%,#2d6a4f 100%);position:fixed;height:100vh;overflow-y:auto;box-shadow:4px 0 20px rgba(27,67,50,0.15)}
.logo{padding:24px 20px;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;align-items:center;gap:14px}
.logo-icon{width:48px;height:48px;background:linear-gradient(135deg,#95d5b2,#52b788);border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;color:#1b4332;font-size:16px;box-shadow:0 4px 12px rgba(0,0,0,0.2)}
.logo-text{font-weight:700;font-size:20px;color:#fff;letter-spacing:1px}
.logo-sub{font-size:10px;color:#95d5b2;text-transform:uppercase;letter-spacing:2px;margin-top:2px}
.nav{padding:16px 12px}
.nav-title{font-size:10px;font-weight:600;color:#95d5b2;padding:12px 16px 8px;text-transform:uppercase;letter-spacing:2px}
.nav-item{display:flex;align-items:center;gap:12px;padding:14px 18px;border-radius:10px;cursor:pointer;color:rgba(255,255,255,0.7);font-size:14px;font-weight:500;margin:4px 0;transition:all 0.2s ease}
.nav-item:hover{background:rgba(255,255,255,0.1);color:#fff;transform:translateX(4px)}
.nav-item.active{background:linear-gradient(135deg,#52b788,#40916c);color:#fff;box-shadow:0 4px 12px rgba(82,183,136,0.3)}
.nav-item span{font-size:18px}
.main{flex:1;margin-left:260px}
.topbar{height:72px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 32px;position:sticky;top:0;z-index:50;box-shadow:0 2px 10px rgba(27,67,50,0.05)}
.page-title{font-size:24px;font-weight:700;display:flex;align-items:center;gap:12px;color:var(--primary-dark)}
.content{padding:32px;max-width:1500px}
.card{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:24px;margin-bottom:24px;box-shadow:0 4px 20px rgba(27,67,50,0.06)}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:16px;border-bottom:2px solid var(--bg3)}
.card-title{font-size:18px;font-weight:700;color:var(--primary-dark)}
.badge{font-size:12px;padding:6px 14px;border-radius:20px;font-weight:600}
.badge-blue{background:#e0f2fe;color:#0369a1}.badge-green{background:#dcfce7;color:#166534}.badge-red{background:#fee2e2;color:#b91c1c}.badge-yellow{background:#fef3c7;color:#b45309}.badge-purple{background:#f3e8ff;color:#7c3aed}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;margin-bottom:32px}
.stat{background:var(--bg2);border:1px solid var(--border);border-radius:16px;padding:20px;position:relative;overflow:hidden;box-shadow:0 4px 15px rgba(27,67,50,0.05)}
.stat::before{content:'';position:absolute;top:0;left:0;width:4px;height:100%;background:var(--primary)}
.stat.green::before{background:linear-gradient(180deg,#52b788,#2d6a4f)}.stat.red::before{background:linear-gradient(180deg,#ef4444,#b91c1c)}.stat.yellow::before{background:linear-gradient(180deg,#fbbf24,#d97706)}.stat.purple::before{background:linear-gradient(180deg,#a78bfa,#7c3aed)}.stat.blue::before{background:linear-gradient(180deg,#38bdf8,#0284c7)}
.stat-label{font-size:12px;color:var(--text2);font-weight:600;margin-bottom:8px;text-transform:uppercase;letter-spacing:0.5px}
.stat-value{font-size:24px;font-weight:800;color:var(--primary-dark)}.stat-sub{font-size:11px;color:var(--text3);margin-top:6px}.stat-krw{font-size:12px;color:var(--text2);margin-top:4px}
table{width:100%;border-collapse:collapse}th,td{padding:14px 16px;text-align:left;border-bottom:1px solid var(--border);font-size:14px}
th{font-size:11px;font-weight:700;color:var(--text2);text-transform:uppercase;background:var(--bg3);letter-spacing:0.5px}tr:hover{background:var(--bg3)}
.text-right{text-align:right}.text-green{color:var(--green)}.text-red{color:var(--red)}.text-blue{color:var(--blue)}.font-bold{font-weight:700}
.summary{background:linear-gradient(135deg,#d8f3dc,#b7e4c7);border:2px solid var(--accent);border-radius:16px;padding:24px;margin-bottom:28px}
.summary-title{font-size:12px;font-weight:700;color:var(--primary-dark);text-transform:uppercase;margin-bottom:16px;letter-spacing:1px}
.summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:24px}
.summary-label{font-size:12px;color:var(--text2);margin-bottom:6px}.summary-value{font-size:22px;font-weight:800;color:var(--primary-dark)}.summary-krw{font-size:11px;color:var(--text2)}
.alert{padding:16px 20px;border-radius:12px;margin-bottom:24px;font-size:14px;background:linear-gradient(135deg,#d8f3dc,#b7e4c7);border:1px solid var(--accent);color:var(--primary-dark);display:flex;align-items:center;gap:10px}
.alert-red{background:linear-gradient(135deg,#fee2e2,#fecaca);border:1px solid #fca5a5;color:#991b1b}
.section{background:var(--bg2);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:24px;box-shadow:0 4px 15px rgba(27,67,50,0.05)}
.section-header{padding:18px 24px;background:linear-gradient(135deg,var(--bg3),#d8f3dc);border-bottom:1px solid var(--border);display:flex;justify-content:space-between;align-items:center}
.section-title{font-size:16px;font-weight:700;display:flex;align-items:center;gap:10px;color:var(--primary-dark)}
.section-body{padding:24px}
.input-row{display:flex;align-items:center;justify-content:space-between;padding:14px 0;border-bottom:1px solid var(--bg3)}.input-row:last-child{border-bottom:none}.input-row label{font-size:14px;font-weight:500;color:var(--text)}
.input-row input{width:130px;padding:12px 14px;background:var(--bg);border:2px solid var(--border);border-radius:10px;font-size:14px;font-weight:600;text-align:right;color:var(--primary-dark);transition:all 0.2s ease}
.input-row input:focus{outline:none;border-color:var(--primary);background:#fff;box-shadow:0 0 0 3px rgba(45,106,79,0.1)}
.input-row .result{font-size:13px;color:var(--text2);min-width:100px;text-align:right}
.divider{height:2px;background:linear-gradient(90deg,transparent,var(--border),transparent);margin:20px 0}
.grid{display:grid;gap:24px}.grid-2{grid-template-columns:repeat(2,1fr)}
@media(max-width:1100px){.grid-2{grid-template-columns:1fr}.sidebar{display:none}.main{margin-left:0}}
@keyframes fadeInOut{0%{opacity:0;transform:translateX(-50%) translateY(-10px)}10%{opacity:1;transform:translateX(-50%) translateY(0)}90%{opacity:1}100%{opacity:0}}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.widget{position:fixed;bottom:24px;right:24px;background:linear-gradient(135deg,#1b4332,#2d6a4f);border-radius:16px;padding:20px 24px;box-shadow:0 8px 32px rgba(27,67,50,0.3);z-index:100;min-width:280px;color:#fff}
.widget h4{font-size:10px;font-weight:700;color:#95d5b2;text-transform:uppercase;margin-bottom:14px;letter-spacing:2px}
.widget-row{display:flex;justify-content:space-between;padding:6px 0;font-size:14px;color:rgba(255,255,255,0.8)}
.widget-row.total{border-top:2px solid rgba(255,255,255,0.2);margin-top:10px;padding-top:14px;font-size:18px;font-weight:700;color:#fff}
.widget-krw{font-size:11px;color:#95d5b2;margin-top:4px}
.save-bar{position:fixed;top:72px;right:32px;display:flex;gap:12px;z-index:60;padding-top:16px}
.save-btn{padding:12px 20px;border-radius:10px;border:none;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s ease;box-shadow:0 4px 12px rgba(0,0,0,0.1)}
.save-btn.primary{background:linear-gradient(135deg,#2d6a4f,#40916c);color:#fff}.save-btn.primary:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(45,106,79,0.3)}
.save-btn.danger{background:#fff;border:2px solid #fca5a5;color:#b91c1c}.save-btn.danger:hover{background:#fee2e2}
.toast{position:fixed;top:100px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#1b4332,#2d6a4f);color:#fff;padding:16px 32px;border-radius:12px;font-weight:600;z-index:200;animation:fadeInOut 2s ease;box-shadow:0 8px 32px rgba(27,67,50,0.3)}
.fee-box{background:linear-gradient(135deg,#fef3c7,#fde68a);border:2px solid #fcd34d;border-radius:12px;padding:18px;margin-top:18px}
.fee-box h5{font-size:12px;font-weight:700;color:#92400e;margin-bottom:12px;text-transform:uppercase;letter-spacing:0.5px}
.fee-row{display:flex;justify-content:space-between;padding:8px 0;font-size:14px;color:#78350f}
.margin-box{background:linear-gradient(135deg,#d8f3dc,#b7e4c7);border:2px solid #6ee7b7;border-radius:12px;padding:18px;margin-top:18px}
.margin-box h5{font-size:12px;font-weight:700;color:#065f46;margin-bottom:12px;text-transform:uppercase;letter-spacing:0.5px}
.margin-row{display:flex;justify-content:space-between;padding:8px 0;font-size:14px;color:#065f46}
.live-dot{width:10px;height:10px;background:#22c55e;border-radius:50%;display:inline-block;margin-right:8px;animation:pulse 1.5s infinite;box-shadow:0 0 8px #22c55e}
.btc-card{background:linear-gradient(135deg,#fef3c7,#fde68a);border:2px solid #f59e0b;border-radius:16px;padding:24px;margin-bottom:24px}
.btc-price{font-size:32px;font-weight:800;color:#d97706}
.btc-change{font-size:13px;padding:6px 12px;border-radius:20px;font-weight:600;margin-left:12px}.btc-change.up{background:#dcfce7;color:#166534}.btc-change.down{background:#fee2e2;color:#b91c1c}
.eco-badge{display:inline-flex;align-items:center;gap:6px;background:linear-gradient(135deg,#d8f3dc,#b7e4c7);padding:6px 12px;border-radius:20px;font-size:11px;font-weight:600;color:#166534;margin-left:12px}
.sync-status{display:flex;align-items:center;gap:8px;font-size:12px;color:#95d5b2;margin-top:8px}
.sync-dot{width:8px;height:8px;border-radius:50%;background:#22c55e;animation:pulse 1.5s infinite}
.sync-dot.offline{background:#ef4444;animation:none}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useMemo,useEffect}=React;
const RATE=1400;

// Firebase ì„¤ì •
const firebaseConfig={
  apiKey:"AIzaSyDAPClHhCgrYs-jCCR-e10YaWaGxpByxpg",
  authDomain:"novaark-ops.firebaseapp.com",
  databaseURL:"https://novaark-ops-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId:"novaark-ops",
  storageBucket:"novaark-ops.firebasestorage.app",
  messagingSenderId:"85862695572",
  appId:"1:85862695572:web:2b3a670c343b2e2e466a81"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const D={
  mem:{t1:{n:200,p:5000000},t2:{n:700,p:1500000},t3:{n:700,p:500000}},
  fee:10,
  land:{ha:573,price:5396,comm:2,legal:200000},
  energy:{t1kw:8,t2kw:5,t3kw:3,commKw:2000,dcKw:1500,mineKw:5000,geoMW:5,hydroMW:15,solarMW:3,windMW:5,geoCostPerMW:800000,hydroCost:600000,solarCost:800000,windCost:900000},
  build:{t1:1250000,t2:450000,t3:300000,hosp:30000000,comm:5000000,school:10000000,uni:4000000,sports:11000000,lib:2000000,theater:5000000,market:4000000,worship:1500000,daycare:2000000,senior:4000000,reserve:4000000,roads:10000000,water:5000000,sewer:6000000,grid:11000000,telecom:3000000,gh:5000000,smart:20000000,live:6000000,fish:3000000,storage:5000000,proc:4000000},
  equip:{security:5000000,medical:10000000,education:3000000,dining:3000000,maintenance:2000000,admin:500000,it:1000000,garden:500000,salon:300000,control:2000000,driver:1500000,cleaning:500000,laundry:800000},
  maintRate:0.05,
  staff:{security:{n:100,sal:40000},medical:{doc:20,nur:60,docSal:150000,nurSal:60000},education:{teach:100,prof:40,tSal:60000,pSal:100000},dining:{chef:30,staff:80,sal:35000},maintenance:{n:50,sal:40000},admin:{n:30,sal:50000},it:{n:20,sal:70000},mining:{n:15,sal:60000},garden:{n:30,sal:35000},fitness:{n:20,sal:40000},salon:{n:15,sal:35000},control:{n:25,sal:55000},concierge:{n:20,sal:45000},driver:{n:30,sal:38000},cleaning:{n:60,sal:32000},laundry:{n:15,sal:32000},farm:{n:40,sal:38000},livestock:{n:20,sal:38000},retail:{n:25,sal:35000}},
  dc:{srv:200,cost:8000,infra:2000000},
  mine:{rigs:4000,cost:5000,active:3928,hashPerRig:110},
  res:{total:50000000},
  income:{dcRental:0,other:0}
};

function calc(s,btc){
  const hh=s.mem.t1.n+s.mem.t2.n+s.mem.t3.n;
  const gross={t1:s.mem.t1.n*s.mem.t1.p,t2:s.mem.t2.n*s.mem.t2.p,t3:s.mem.t3.n*s.mem.t3.p};
  gross.total=gross.t1+gross.t2+gross.t3;
  const fee=gross.total*(s.fee/100);const net=gross.total-fee;
  const eD={t1:s.mem.t1.n*s.energy.t1kw,t2:s.mem.t2.n*s.energy.t2kw,t3:s.mem.t3.n*s.energy.t3kw,comm:s.energy.commKw,dc:s.energy.dcKw,mine:s.energy.mineKw};
  eD.res=eD.t1+eD.t2+eD.t3;eD.total=eD.res+eD.comm+eD.dc+eD.mine;
  const eS=(s.energy.geoMW+s.energy.hydroMW+s.energy.solarMW+s.energy.windMW)*1000;
  const eC=s.energy.geoMW*s.energy.geoCostPerMW+s.energy.hydroMW*s.energy.hydroCost+s.energy.solarMW*s.energy.solarCost+s.energy.windMW*s.energy.windCost;
  const land=s.land.ha*s.land.price*(1+s.land.comm/100)+s.land.legal;
  const bldT1=s.mem.t1.n*s.build.t1,bldT2=s.mem.t2.n*s.build.t2,bldT3=s.mem.t3.n*s.build.t3;
  const bldH=bldT1+bldT2+bldT3;
  const bldF=s.build.hosp+s.build.comm+s.build.school+s.build.uni+s.build.sports+s.build.lib+s.build.theater+s.build.market+s.build.worship+s.build.daycare+s.build.senior+s.build.reserve;
  const bldI=s.build.roads+s.build.water+s.build.sewer+s.build.grid+s.build.telecom;
  const bldA=s.build.gh+s.build.smart+s.build.live+s.build.fish+s.build.storage+s.build.proc;
  const bldT=bldH+bldF+bldI+bldA;
  const equipT=Object.values(s.equip).reduce((a,b)=>a+b,0);
  const maintYear=equipT*s.maintRate;
  const st=s.staff;
  const laborYear={
    security:st.security.n*st.security.sal,medical:st.medical.doc*st.medical.docSal+st.medical.nur*st.medical.nurSal,
    education:st.education.teach*st.education.tSal+st.education.prof*st.education.pSal,
    dining:(st.dining.chef+st.dining.staff)*st.dining.sal,maintenance:st.maintenance.n*st.maintenance.sal,
    admin:st.admin.n*st.admin.sal,it:st.it.n*st.it.sal,mining:st.mining.n*st.mining.sal,
    garden:st.garden.n*st.garden.sal,fitness:st.fitness.n*st.fitness.sal,salon:st.salon.n*st.salon.sal,
    control:st.control.n*st.control.sal,concierge:st.concierge.n*st.concierge.sal,driver:st.driver.n*st.driver.sal,
    cleaning:st.cleaning.n*st.cleaning.sal,laundry:st.laundry.n*st.laundry.sal,
    farm:st.farm.n*st.farm.sal,livestock:st.livestock.n*st.livestock.sal,retail:st.retail.n*st.retail.sal
  };
  const laborTotal=Object.values(laborYear).reduce((a,b)=>a+b,0);
  const laborMonth=laborTotal/12;
  const dc=s.dc.srv*s.dc.cost+s.dc.infra;
  const mineCost=s.mine.rigs*s.mine.cost;
  const activeRate=s.mine.rigs>0?s.mine.active/s.mine.rigs:0;
  const totalHashTH=s.mine.active*s.mine.hashPerRig;
  const totalHashEH=totalHashTH/1e6;
  const networkEH=btc.networkHash;
  const dailyBTC=networkEH>0?(totalHashEH/networkEH)*144*6.25:0;
  const dailyUSD=dailyBTC*btc.price;
  const mineRev={dailyBTC,dailyUSD,monthlyBTC:dailyBTC*30,monthlyUSD:dailyUSD*30,yearlyBTC:dailyBTC*365,yearlyUSD:dailyUSD*365,totalHashTH,totalHashEH};
  const exp=land+eC+bldT+equipT+dc+mineCost+s.res.total;
  const totalExp=exp+fee;
  const marginT1=s.mem.t1.p-s.build.t1,marginT2=s.mem.t2.p-s.build.t2,marginT3=s.mem.t3.p-s.build.t3;
  const marginRateT1=(marginT1/s.mem.t1.p*100),marginRateT2=(marginT2/s.mem.t2.p*100),marginRateT3=(marginT3/s.mem.t3.p*100);
  return{hh,ppl:Math.round(hh*3.125),gross,fee,net,eD,eS,eC,land,bldT1,bldT2,bldT3,bldH,bldF,bldI,bldA,bldT,equipT,maintYear,laborYear,laborTotal,laborMonth,dc,mineCost,mineRev,res:s.res.total,exp,totalExp,bal:net-exp,marginT1,marginT2,marginT3,marginRateT1,marginRateT2,marginRateT3,activeRate};
}

const fmt=v=>{const a=Math.abs(v);if(a>=1e9)return`$${(v/1e9).toFixed(2)}B`;if(a>=1e6)return`$${(v/1e6).toFixed(1)}M`;if(a>=1e3)return`$${(v/1e3).toFixed(0)}K`;return`$${v.toLocaleString()}`};
const fmtK=v=>{const k=v*RATE;if(Math.abs(k)>=1e12)return`â‚©${(k/1e12).toFixed(2)}ì¡°`;if(Math.abs(k)>=1e8)return`â‚©${(k/1e8).toFixed(0)}ì–µ`;return`â‚©${k.toLocaleString()}`};
const fmtBoth=v=>`${fmt(v)} (${fmtK(v)})`;
const fmtN=v=>v.toLocaleString();
const fmtP=v=>`${v.toFixed(1)}%`;
const fmtBTC=v=>v.toFixed(4);

const Stat=({label,value,sub,color='',krw})=><div className={`stat ${color}`}><div className="stat-label">{label}</div><div className="stat-value">{value}</div>{krw&&<div className="stat-krw">{krw}</div>}{sub&&<div className="stat-sub">{sub}</div>}</div>;

const Input=({label,value,onChange,suf='',pre='',result})=>{
  const[local,setLocal]=useState(String(value));
  useEffect(()=>{setLocal(String(value));},[value]);
  const handleChange=e=>{setLocal(e.target.value);};
  const handleBlur=()=>{const n=Number(local);if(!isNaN(n))onChange(n);else setLocal(String(value));};
  const handleKey=e=>{if(e.key==='Enter')e.target.blur();};
  return<div className="input-row"><label>{label}</label><div style={{display:'flex',alignItems:'center',gap:'8px'}}>{result&&<span className="result">{result}</span>}{pre&&<span style={{color:'var(--text2)',fontWeight:500}}>{pre}</span>}<input type="text" inputMode="numeric" value={local} onChange={handleChange} onBlur={handleBlur} onKeyDown={handleKey}/>{suf&&<span style={{color:'var(--text2)',fontWeight:500}}>{suf}</span>}</div></div>;
};
const Sidebar=({page,setPage,isOnline})=>{
  const nav=[{id:'dashboard',icon:'ğŸ“Š',label:'ëŒ€ì‹œë³´ë“œ'},{id:'income',icon:'ğŸ’°',label:'ìˆ˜ì…'},{id:'expense',icon:'ğŸ’¸',label:'ì§€ì¶œ'},{id:'membership',icon:'ğŸ‘¥',label:'ë©¤ë²„ì‹­'},{id:'construction',icon:'ğŸ—ï¸',label:'ê±´ì¶•'},{id:'energy',icon:'âš¡',label:'ì—ë„ˆì§€'},{id:'services',icon:'ğŸ¥',label:'ì„œë¹„ìŠ¤/ì¸ë ¥'},{id:'tech',icon:'ğŸ–¥ï¸',label:'ê¸°ìˆ '}];
  return<div className="sidebar">
    <div className="logo">
      <div className="logo-icon">NA</div>
      <div><div className="logo-text">NOVA ARK</div><div className="logo-sub">Smart Green City</div></div>
    </div>
    <div className="nav">
      <div className="nav-title">ë©”ë‰´</div>
      {nav.map(n=><div key={n.id} className={`nav-item ${page===n.id?'active':''}`} onClick={()=>setPage(n.id)}><span>{n.icon}</span>{n.label}</div>)}
      <div className="sync-status"><span className={`sync-dot ${isOnline?'':'offline'}`}></span>{isOnline?'ì„œë²„ ì—°ê²°ë¨':'ì˜¤í”„ë¼ì¸'}</div>
    </div>
  </div>;
};

const Dashboard=({s,f,btc})=><div>
  <div className="alert">ğŸŒ¿ 100% ì¬ìƒì—ë„ˆì§€ ê¸°ë°˜ ìŠ¤ë§ˆíŠ¸ ê·¸ë¦°ì‹œí‹° | í™˜ìœ¨: $1 = â‚©{RATE.toLocaleString()}</div>
  {f.bal<0&&<div className="alert alert-red">âš ï¸ ì ì ìƒíƒœì…ë‹ˆë‹¤.</div>}
  <div className="stats">
    <Stat label="ì´ ê°€êµ¬" value={fmtN(f.hh)} sub={`ì•½ ${fmtN(f.ppl)}ëª…`}/>
    <Stat label="ì´ ìˆ˜ì…" value={fmt(f.gross.total)} krw={fmtK(f.gross.total)} color="green"/>
    <Stat label="ë³¸ì‚¬ ë¡œì–„í‹°" value={fmt(f.fee)} krw={fmtK(f.fee)} sub={`${s.fee}%`} color="yellow"/>
    <Stat label="ìˆœ ìˆ˜ì…" value={fmt(f.net)} krw={fmtK(f.net)} color="green"/>
    <Stat label="ì´ ì§€ì¶œ" value={fmt(f.totalExp)} krw={fmtK(f.totalExp)} color="red"/>
    <Stat label="ì‰ì—¬ê¸ˆ" value={fmt(f.bal)} krw={fmtK(f.bal)} sub={f.bal>=0?'í‘ì âœ“':'ì ì âš ï¸'} color={f.bal>=0?'green':'red'}/>
  </div>
  <div className="grid grid-2">
    <div className="card"><div className="card-header"><span className="card-title">ğŸ“Š ë©¤ë²„ì‹­ & ë§ˆì§„</span></div>
      <table><thead><tr><th>í‹°ì–´</th><th className="text-right">íŒë§¤ê°€</th><th className="text-right">ê±´ì¶•ë¹„</th><th className="text-right">ë§ˆì§„</th><th className="text-right">ë§ˆì§„ìœ¨</th></tr></thead><tbody>
        <tr><td><span className="badge badge-yellow">T1 Sovereign</span></td><td className="text-right">{fmt(s.mem.t1.p)}</td><td className="text-right">{fmt(s.build.t1)}</td><td className="text-right font-bold text-green">{fmt(f.marginT1)}</td><td className="text-right">{fmtP(f.marginRateT1)}</td></tr>
        <tr><td><span className="badge badge-purple">T2 Guardian</span></td><td className="text-right">{fmt(s.mem.t2.p)}</td><td className="text-right">{fmt(s.build.t2)}</td><td className="text-right font-bold text-green">{fmt(f.marginT2)}</td><td className="text-right">{fmtP(f.marginRateT2)}</td></tr>
        <tr><td><span className="badge badge-blue">T3 Citizen</span></td><td className="text-right">{fmt(s.mem.t3.p)}</td><td className="text-right">{fmt(s.build.t3)}</td><td className="text-right font-bold text-green">{fmt(f.marginT3)}</td><td className="text-right">{fmtP(f.marginRateT3)}</td></tr>
      </tbody></table>
    </div>
    <div className="card"><div className="card-header"><span className="card-title">âš¡ ê·¸ë¦° ì—ë„ˆì§€<span className="eco-badge">ğŸŒ± 100% ì¬ìƒ</span></span></div>
      <table><tbody>
        <tr><td>í•„ìš” ì „ë ¥</td><td className="text-right font-bold">{(f.eD.total/1000).toFixed(1)} MW</td></tr>
        <tr><td>ë°œì „ ìš©ëŸ‰</td><td className="text-right font-bold text-green">{(f.eS/1000).toFixed(1)} MW</td></tr>
        <tr style={{background:'var(--bg3)'}}><td className="font-bold">ì‰ì—¬ ì „ë ¥</td><td className="text-right font-bold text-blue">{((f.eS-f.eD.total)/1000).toFixed(1)} MW</td></tr>
      </tbody></table>
    </div>
  </div>
  <div className="card"><div className="card-header"><span className="card-title">ğŸ’¸ ì´ˆê¸° ì§€ì¶œ ë‚´ì—­</span></div>
    <table><thead><tr><th>í•­ëª©</th><th className="text-right">ê¸ˆì•¡</th><th className="text-right">ì›í™”</th><th className="text-right">ë¹„ìœ¨</th></tr></thead><tbody>
      <tr style={{background:'#fef9c3'}}><td>ğŸ’¼ ë³¸ì‚¬ ë¡œì–„í‹°</td><td className="text-right">{fmt(f.fee)}</td><td className="text-right">{fmtK(f.fee)}</td><td className="text-right">{fmtP(f.fee/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ—ºï¸ í† ì§€</td><td className="text-right">{fmt(f.land)}</td><td className="text-right">{fmtK(f.land)}</td><td className="text-right">{fmtP(f.land/f.totalExp*100)}</td></tr>
      <tr><td>âš¡ ì—ë„ˆì§€</td><td className="text-right">{fmt(f.eC)}</td><td className="text-right">{fmtK(f.eC)}</td><td className="text-right">{fmtP(f.eC/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ  ì£¼ê±° ê±´ì¶•</td><td className="text-right">{fmt(f.bldH)}</td><td className="text-right">{fmtK(f.bldH)}</td><td className="text-right">{fmtP(f.bldH/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ›ï¸ ê³µìš©ì‹œì„¤</td><td className="text-right">{fmt(f.bldF)}</td><td className="text-right">{fmtK(f.bldF)}</td><td className="text-right">{fmtP(f.bldF/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ› ï¸ ì¸í”„ë¼</td><td className="text-right">{fmt(f.bldI)}</td><td className="text-right">{fmtK(f.bldI)}</td><td className="text-right">{fmtP(f.bldI/f.totalExp*100)}</td></tr>
      <tr><td>ğŸŒ¾ ë†ì—…/ì‹ëŸ‰</td><td className="text-right">{fmt(f.bldA)}</td><td className="text-right">{fmtK(f.bldA)}</td><td className="text-right">{fmtP(f.bldA/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ”§ ì´ˆê¸° ì¥ë¹„</td><td className="text-right">{fmt(f.equipT)}</td><td className="text-right">{fmtK(f.equipT)}</td><td className="text-right">{fmtP(f.equipT/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ–¥ï¸ ë°ì´í„°ì„¼í„°</td><td className="text-right">{fmt(f.dc)}</td><td className="text-right">{fmtK(f.dc)}</td><td className="text-right">{fmtP(f.dc/f.totalExp*100)}</td></tr>
      <tr><td>â›ï¸ ë§ˆì´ë‹</td><td className="text-right">{fmt(f.mineCost)}</td><td className="text-right">{fmtK(f.mineCost)}</td><td className="text-right">{fmtP(f.mineCost/f.totalExp*100)}</td></tr>
      <tr><td>ğŸ¦ ë¹„ì¶•ê¸ˆ</td><td className="text-right">{fmt(f.res)}</td><td className="text-right">{fmtK(f.res)}</td><td className="text-right">{fmtP(f.res/f.totalExp*100)}</td></tr>
      <tr style={{background:'#fee2e2'}}><td className="font-bold">ì´ê³„</td><td className="text-right font-bold text-red">{fmt(f.totalExp)}</td><td className="text-right font-bold">{fmtK(f.totalExp)}</td><td className="text-right font-bold">100%</td></tr>
    </tbody></table>
  </div>
  <div className="summary"><div className="summary-title">ğŸŒ¿ í•µì‹¬ ì§€í‘œ</div><div className="summary-grid">
    <div><div className="summary-label">ê°€êµ¬ë‹¹ ì§€ì¶œ</div><div className="summary-value">{fmt(f.totalExp/f.hh)}</div><div className="summary-krw">{fmtK(f.totalExp/f.hh)}</div></div>
    <div><div className="summary-label">ì—°ê°„ ì¸ê±´ë¹„</div><div className="summary-value">{fmt(f.laborTotal)}</div><div className="summary-krw">{fmtK(f.laborTotal)}</div></div>
    <div><div className="summary-label">ë§ˆì´ë‹ ì—°ìˆ˜ìµ</div><div className="summary-value" style={{color:'#166534'}}>{fmt(f.mineRev.yearlyUSD)}</div><div className="summary-krw">{fmtBTC(f.mineRev.yearlyBTC)} BTC</div></div>
    <div><div className="summary-label">BTC ì‹¤ì‹œê°„</div><div className="summary-value">${fmtN(Math.round(btc.price))}</div><div className="summary-krw"><span className="live-dot"></span>LIVE</div></div>
  </div></div>
</div>;
const Income=({s,setS,f,btc})=>{
  const updI=(k,v)=>setS(p=>({...p,income:{...p.income,[k]:v}}));
  return<div>
    <div className="stats">
      <Stat label="ë©¤ë²„ì‹­ ìˆ˜ì…" value={fmt(f.gross.total)} krw={fmtK(f.gross.total)} color="green"/>
      <Stat label="ë§ˆì´ë‹ ìˆ˜ìµ(ì—°)" value={fmt(f.mineRev.yearlyUSD)} krw={`${fmtBTC(f.mineRev.yearlyBTC)} BTC`} color="yellow"/>
      <Stat label="DC ì„ëŒ€ ìˆ˜ìµ" value={fmt(s.income.dcRental)} krw={fmtK(s.income.dcRental)} color="purple"/>
      <Stat label="ê¸°íƒ€ ìˆ˜ì…" value={fmt(s.income.other)} krw={fmtK(s.income.other)} color="blue"/>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ‘¥ í‹°ì–´ë³„ ì…ê¸ˆ</div><span className="badge badge-green">{fmtBoth(f.gross.total)}</span></div>
      <div className="section-body">
        <table><thead><tr><th>í‹°ì–´</th><th className="text-right">ê°€êµ¬ìˆ˜</th><th className="text-right">ë‹¨ê°€</th><th className="text-right">í•©ê³„</th></tr></thead><tbody>
          <tr><td><span className="badge badge-yellow">Tier 1 Sovereign</span></td><td className="text-right">{s.mem.t1.n}</td><td className="text-right">{fmt(s.mem.t1.p)}</td><td className="text-right font-bold">{fmtBoth(f.gross.t1)}</td></tr>
          <tr><td><span className="badge badge-purple">Tier 2 Guardian</span></td><td className="text-right">{s.mem.t2.n}</td><td className="text-right">{fmt(s.mem.t2.p)}</td><td className="text-right font-bold">{fmtBoth(f.gross.t2)}</td></tr>
          <tr><td><span className="badge badge-blue">Tier 3 Citizen</span></td><td className="text-right">{s.mem.t3.n}</td><td className="text-right">{fmt(s.mem.t3.p)}</td><td className="text-right font-bold">{fmtBoth(f.gross.t3)}</td></tr>
          <tr style={{background:'#dcfce7'}}><td className="font-bold">í•©ê³„</td><td className="text-right font-bold">{f.hh}</td><td></td><td className="text-right font-bold text-green">{fmtBoth(f.gross.total)}</td></tr>
        </tbody></table>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">â›ï¸ ë§ˆì´ë‹ ìˆ˜ìµ</div><span className="badge badge-yellow"><span className="live-dot"></span>ì‹¤ì‹œê°„</span></div>
      <div className="section-body">
        <div className="btc-card">
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',flexWrap:'wrap',gap:16}}>
            <div><div style={{fontSize:12,color:'var(--text2)',marginBottom:6}}><span className="live-dot"></span>BTC ì‹¤ì‹œê°„ ê°€ê²©</div><span className="btc-price">${fmtN(Math.round(btc.price))}</span><span className={`btc-change ${btc.change>=0?'up':'down'}`}>{btc.change>=0?'â–²':'â–¼'} {Math.abs(btc.change).toFixed(1)}%</span></div>
            <div style={{textAlign:'right'}}><div style={{fontSize:12,color:'var(--text2)',marginBottom:6}}>ë„¤íŠ¸ì›Œí¬ í•´ì‹œë ˆì´íŠ¸</div><div style={{fontSize:22,fontWeight:700,color:'#d97706'}}>{btc.networkHash.toFixed(2)} EH/s</div></div>
          </div>
        </div>
        <table><tbody>
          <tr><td>ê°€ë™ë¥ </td><td className="text-right font-bold">{fmtP(f.activeRate*100)} ({fmtN(s.mine.active)} / {fmtN(s.mine.rigs)} ëŒ€)</td></tr>
          <tr><td>ì´ í•´ì‹œë ˆì´íŠ¸</td><td className="text-right font-bold">{fmtN(Math.round(f.mineRev.totalHashTH))} TH/s ({f.mineRev.totalHashEH.toFixed(4)} EH/s)</td></tr>
          <tr style={{background:'#fef9c3'}}><td className="font-bold">ì¼ì¼ ì±„êµ´ ìˆ˜ìµ</td><td className="text-right font-bold text-green">{fmtBTC(f.mineRev.dailyBTC)} BTC â‰ˆ {fmt(f.mineRev.dailyUSD)}/day</td></tr>
          <tr><td>ì›”ê°„ ì±„êµ´ ìˆ˜ìµ</td><td className="text-right">{fmtBTC(f.mineRev.monthlyBTC)} BTC â‰ˆ {fmt(f.mineRev.monthlyUSD)}/month</td></tr>
          <tr style={{background:'#dcfce7'}}><td className="font-bold">ì—°ê°„ ì±„êµ´ ìˆ˜ìµ</td><td className="text-right font-bold text-green">{fmtBTC(f.mineRev.yearlyBTC)} BTC â‰ˆ {fmtBoth(f.mineRev.yearlyUSD)}/year</td></tr>
        </tbody></table>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ–¥ï¸ ë°ì´í„°ì„¼í„° ì„ëŒ€ ìˆ˜ìµ</div><span className="badge badge-purple">{fmtBoth(s.income.dcRental)}</span></div>
      <div className="section-body"><Input label="ì—°ê°„ ì„ëŒ€ ìˆ˜ìµ" value={s.income.dcRental} onChange={v=>updI('dcRental',v)} pre="$" result={fmtK(s.income.dcRental)}/></div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ“¦ ê¸°íƒ€ ìˆ˜ì…</div><span className="badge badge-blue">{fmtBoth(s.income.other)}</span></div>
      <div className="section-body"><Input label="ê¸°íƒ€ ì—°ê°„ ìˆ˜ì…" value={s.income.other} onChange={v=>updI('other',v)} pre="$" result={fmtK(s.income.other)}/></div>
    </div>
  </div>;
};

const Expense=({s,setS,f})=>{
  const updEq=(k,v)=>setS(p=>({...p,equip:{...p.equip,[k]:v}}));
  const updMR=v=>setS(p=>({...p,maintRate:v/100}));
  const laborNames={security:'ğŸ›¡ï¸ ë³´ì•ˆ',medical:'ğŸ¥ ì˜ë£Œ',education:'ğŸ“ êµìœ¡',dining:'ğŸ½ï¸ ì‹ë‹¹',maintenance:'ğŸ”§ ì‹œì„¤ê´€ë¦¬',admin:'ğŸ“‹ í–‰ì •',it:'ğŸ’» IT',mining:'â›ï¸ ë§ˆì´ë‹',garden:'ğŸŒ³ ì¡°ê²½',fitness:'ğŸ‹ï¸ í”¼íŠ¸ë‹ˆìŠ¤',salon:'ğŸ’‡ ë¯¸ìš©',control:'ğŸ“¡ ê´€ì œ',concierge:'ğŸ›ï¸ ì»¨ì‹œì–´ì§€',driver:'ğŸš ìš´ì†¡',cleaning:'ğŸ§¹ ì²­ì†Œ',laundry:'ğŸ‘” ì„¸íƒ',farm:'ğŸŒ¾ ë†ì¥',livestock:'ğŸ„ ì¶•ì‚°',retail:'ğŸ›’ ë¦¬í…Œì¼'};
  return<div>
    <div className="stats">
      <Stat label="ì´ˆê¸° ì§€ì¶œ" value={fmt(f.exp)} krw={fmtK(f.exp)} color="red"/>
      <Stat label="ì´ˆê¸° ì¥ë¹„" value={fmt(f.equipT)} krw={fmtK(f.equipT)} color="purple"/>
      <Stat label="ì—°ê°„ ì¸ê±´ë¹„" value={fmt(f.laborTotal)} krw={fmtK(f.laborTotal)} color="blue"/>
      <Stat label="ì—°ê°„ ìœ ì§€ë³´ìˆ˜" value={fmt(f.maintYear)} krw={fmtK(f.maintYear)} color="yellow"/>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ—ï¸ ê±´ì¶• ì§€ì¶œ</div><span className="badge badge-blue">{fmtBoth(f.bldT)}</span></div>
      <div className="section-body"><table><thead><tr><th>í•­ëª©</th><th className="text-right">ê¸ˆì•¡</th><th className="text-right">ì›í™”</th></tr></thead><tbody>
        <tr><td>ğŸ  ì£¼ê±° ê±´ì¶•</td><td className="text-right">{fmt(f.bldH)}</td><td className="text-right">{fmtK(f.bldH)}</td></tr>
        <tr><td style={{paddingLeft:30}}>- T1 ({s.mem.t1.n}ì±„)</td><td className="text-right">{fmt(f.bldT1)}</td><td className="text-right">{fmtK(f.bldT1)}</td></tr>
        <tr><td style={{paddingLeft:30}}>- T2 ({s.mem.t2.n}ì±„)</td><td className="text-right">{fmt(f.bldT2)}</td><td className="text-right">{fmtK(f.bldT2)}</td></tr>
        <tr><td style={{paddingLeft:30}}>- T3 ({s.mem.t3.n}ì±„)</td><td className="text-right">{fmt(f.bldT3)}</td><td className="text-right">{fmtK(f.bldT3)}</td></tr>
        <tr><td>ğŸ›ï¸ ê³µìš©ì‹œì„¤</td><td className="text-right">{fmt(f.bldF)}</td><td className="text-right">{fmtK(f.bldF)}</td></tr>
        <tr style={{background:'#dbeafe'}}><td className="font-bold">ê±´ì¶• ì†Œê³„</td><td className="text-right font-bold">{fmt(f.bldT)}</td><td className="text-right font-bold">{fmtK(f.bldT)}</td></tr>
      </tbody></table></div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ”§ ì´ˆê¸° ì¥ë¹„ (1íšŒì„±)</div><span className="badge badge-purple">{fmtBoth(f.equipT)}</span></div>
      <div className="section-body">
        <Input label="ğŸ›¡ï¸ ë³´ì•ˆ ì¥ë¹„/ì°¨ëŸ‰" value={s.equip.security} onChange={v=>updEq('security',v)} pre="$" result={fmtK(s.equip.security)}/>
        <Input label="ğŸ¥ ì˜ë£Œ ì¥ë¹„" value={s.equip.medical} onChange={v=>updEq('medical',v)} pre="$" result={fmtK(s.equip.medical)}/>
        <Input label="ğŸ“ êµìœ¡ ì¥ë¹„" value={s.equip.education} onChange={v=>updEq('education',v)} pre="$" result={fmtK(s.equip.education)}/>
        <Input label="ğŸ½ï¸ ì£¼ë°©/ì‹ë‹¹ ì¥ë¹„" value={s.equip.dining} onChange={v=>updEq('dining',v)} pre="$" result={fmtK(s.equip.dining)}/>
        <Input label="ğŸ”§ ì‹œì„¤ê´€ë¦¬ ì¥ë¹„" value={s.equip.maintenance} onChange={v=>updEq('maintenance',v)} pre="$" result={fmtK(s.equip.maintenance)}/>
        <Input label="ğŸ“‹ ì‚¬ë¬´/í–‰ì • ì¥ë¹„" value={s.equip.admin} onChange={v=>updEq('admin',v)} pre="$" result={fmtK(s.equip.admin)}/>
        <Input label="ğŸ’» IT ì¥ë¹„" value={s.equip.it} onChange={v=>updEq('it',v)} pre="$" result={fmtK(s.equip.it)}/>
        <Input label="ğŸŒ³ ì¡°ê²½ ì¥ë¹„" value={s.equip.garden} onChange={v=>updEq('garden',v)} pre="$" result={fmtK(s.equip.garden)}/>
        <Input label="ğŸ’‡ ë¯¸ìš© ì¥ë¹„" value={s.equip.salon} onChange={v=>updEq('salon',v)} pre="$" result={fmtK(s.equip.salon)}/>
        <Input label="ğŸ“¡ ê´€ì œ ì¥ë¹„" value={s.equip.control} onChange={v=>updEq('control',v)} pre="$" result={fmtK(s.equip.control)}/>
        <Input label="ğŸš ì°¨ëŸ‰" value={s.equip.driver} onChange={v=>updEq('driver',v)} pre="$" result={fmtK(s.equip.driver)}/>
        <Input label="ğŸ§¹ ì²­ì†Œ ì¥ë¹„" value={s.equip.cleaning} onChange={v=>updEq('cleaning',v)} pre="$" result={fmtK(s.equip.cleaning)}/>
        <Input label="ğŸ‘” ì„¸íƒ ì¥ë¹„" value={s.equip.laundry} onChange={v=>updEq('laundry',v)} pre="$" result={fmtK(s.equip.laundry)}/>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ”„ ì—°ê°„ ìœ ì§€ë³´ìˆ˜ë¹„</div><span className="badge badge-yellow">{fmtBoth(f.maintYear)}</span></div>
      <div className="section-body">
        <Input label="ìœ ì§€ë³´ìˆ˜ìœ¨ (ì¥ë¹„ ëŒ€ë¹„)" value={Math.round(s.maintRate*100)} onChange={updMR} suf="%"/>
        <div className="divider"></div>
        <table><tbody>
          <tr><td>ì´ˆê¸° ì¥ë¹„ ì´ì•¡</td><td className="text-right">{fmtBoth(f.equipT)}</td></tr>
          <tr><td>ìœ ì§€ë³´ìˆ˜ìœ¨</td><td className="text-right">{fmtP(s.maintRate*100)}</td></tr>
          <tr style={{background:'#fef9c3'}}><td className="font-bold">ì—°ê°„ ìœ ì§€ë³´ìˆ˜ë¹„</td><td className="text-right font-bold">{fmtBoth(f.maintYear)}</td></tr>
        </tbody></table>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ‘¥ ì¸ê±´ë¹„</div><span className="badge badge-blue">{fmtBoth(f.laborTotal)}</span></div>
      <div className="section-body">
        <table><thead><tr><th>ë¶€ì„œ</th><th className="text-right">ì—°ê°„</th><th className="text-right">ì›”ê°„</th></tr></thead><tbody>
          {Object.entries(f.laborYear).map(([k,v])=><tr key={k}><td>{laborNames[k]||k}</td><td className="text-right">{fmt(v)}</td><td className="text-right">{fmt(v/12)}</td></tr>)}
          <tr style={{background:'#dbeafe'}}><td className="font-bold">í•©ê³„</td><td className="text-right font-bold">{fmtBoth(f.laborTotal)}</td><td className="text-right font-bold">{fmtBoth(f.laborMonth)}</td></tr>
        </tbody></table>
      </div>
    </div>
  </div>;
};
const Membership=({s,setS,f})=>{
  const upd=(t,k,v)=>setS(p=>({...p,mem:{...p.mem,[t]:{...p.mem[t],[k]:v}}}));
  return<div>
    <div className="stats">
      <Stat label="ì´ ê°€êµ¬" value={fmtN(f.hh)} sub={`ì•½ ${fmtN(f.ppl)}ëª…`}/>
      <Stat label="ì´ ìˆ˜ì…" value={fmt(f.gross.total)} krw={fmtK(f.gross.total)} color="green"/>
      <Stat label="ë³¸ì‚¬ ë¡œì–„í‹°" value={fmt(f.fee)} krw={fmtK(f.fee)} sub={`${s.fee}%`} color="yellow"/>
      <Stat label="ìˆœ ìˆ˜ì…" value={fmt(f.net)} krw={fmtK(f.net)} color="green"/>
    </div>
    {[{k:'t1',n:'Tier 1 - Sovereign (100í‰)',c:'#f59e0b',bg:'#fef3c7',i:'ğŸ‘‘',cost:s.build.t1,margin:f.marginT1,rate:f.marginRateT1},{k:'t2',n:'Tier 2 - Guardian (45í‰)',c:'#8b5cf6',bg:'#ede9fe',i:'ğŸ›¡ï¸',cost:s.build.t2,margin:f.marginT2,rate:f.marginRateT2},{k:'t3',n:'Tier 3 - Citizen (25í‰)',c:'#0ea5e9',bg:'#e0f2fe',i:'ğŸ ',cost:s.build.t3,margin:f.marginT3,rate:f.marginRateT3}].map(t=>
      <div className="section" key={t.k} style={{borderLeft:`4px solid ${t.c}`}}>
        <div className="section-header"><div className="section-title"><span style={{fontSize:22}}>{t.i}</span>{t.n}</div><span className="badge" style={{background:t.bg,color:t.c}}>{fmtBoth(f.gross[t.k])}</span></div>
        <div className="section-body">
          <Input label="ê°€êµ¬ ìˆ˜" value={s.mem[t.k].n} onChange={v=>upd(t.k,'n',v)} suf="ê°€êµ¬"/>
          <Input label="ë©¤ë²„ì‹­ ê°€ê²©" value={s.mem[t.k].p} onChange={v=>upd(t.k,'p',v)} pre="$" result={fmtK(s.mem[t.k].p)}/>
          <div className="margin-box"><h5>ğŸ’° ë§ˆì§„ ë¶„ì„</h5>
            <div className="margin-row"><span>íŒë§¤ê°€</span><span>{fmtBoth(s.mem[t.k].p)}</span></div>
            <div className="margin-row"><span>ê±´ì¶•ë¹„</span><span>{fmtBoth(t.cost)}</span></div>
            <div className="margin-row" style={{fontWeight:700,borderTop:'2px solid #6ee7b7',paddingTop:10,marginTop:6}}><span>ì„¸ëŒ€ë‹¹ ë§ˆì§„</span><span>{fmtBoth(t.margin)} ({fmtP(t.rate)})</span></div>
          </div>
        </div>
      </div>
    )}
    <div className="card"><div className="card-header"><span className="card-title">ğŸ’¼ ë³¸ì‚¬ ë¡œì–„í‹°</span></div>
      <Input label="ë¡œì–„í‹°ìœ¨" value={s.fee} onChange={v=>setS(p=>({...p,fee:v}))} suf="%"/>
      <div className="fee-box"><h5>ğŸ“Š ë¡œì–„í‹° ê³„ì‚°</h5>
        <div className="fee-row"><span>ì´ ìˆ˜ì…</span><span>{fmtBoth(f.gross.total)}</span></div>
        <div className="fee-row"><span>ë¡œì–„í‹°ìœ¨</span><span>{s.fee}%</span></div>
        <div className="fee-row" style={{fontWeight:700,borderTop:'2px solid #fcd34d',paddingTop:12,marginTop:8}}><span>ë³¸ì‚¬ ë¡œì–„í‹°</span><span>{fmtBoth(f.fee)}</span></div>
      </div>
    </div>
  </div>;
};

const Construction=({s,setS,f})=>{
  const upd=(k,v)=>setS(p=>({...p,build:{...p.build,[k]:v}}));
  return<div>
    <div className="stats">
      <Stat label="ì£¼ê±° ê±´ì¶•" value={fmt(f.bldH)} krw={fmtK(f.bldH)} color="blue"/>
      <Stat label="ê³µìš©ì‹œì„¤" value={fmt(f.bldF)} krw={fmtK(f.bldF)} color="purple"/>
      <Stat label="ì¸í”„ë¼" value={fmt(f.bldI)} krw={fmtK(f.bldI)} color="yellow"/>
      <Stat label="ë†ì—…/ì‹ëŸ‰" value={fmt(f.bldA)} krw={fmtK(f.bldA)} color="green"/>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ  ì£¼ê±° ê±´ì¶•</div><span className="badge badge-blue">{fmtBoth(f.bldH)}</span></div>
      <div className="section-body">
        <Input label="Tier 1 ë‹¨ê°€" value={s.build.t1} onChange={v=>upd('t1',v)} pre="$" result={`${s.mem.t1.n}ì±„ = ${fmtBoth(f.bldT1)}`}/>
        <Input label="Tier 2 ë‹¨ê°€" value={s.build.t2} onChange={v=>upd('t2',v)} pre="$" result={`${s.mem.t2.n}ì±„ = ${fmtBoth(f.bldT2)}`}/>
        <Input label="Tier 3 ë‹¨ê°€" value={s.build.t3} onChange={v=>upd('t3',v)} pre="$" result={`${s.mem.t3.n}ì±„ = ${fmtBoth(f.bldT3)}`}/>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ›ï¸ ê³µìš©ì‹œì„¤</div><span className="badge badge-purple">{fmtBoth(f.bldF)}</span></div>
      <div className="section-body">
        <Input label="ğŸ¥ ì¢…í•©ë³‘ì›" value={s.build.hosp} onChange={v=>upd('hosp',v)} pre="$" result={fmtK(s.build.hosp)}/>
        <Input label="ğŸ¢ ì»¤ë®¤ë‹ˆí‹°ì„¼í„°" value={s.build.comm} onChange={v=>upd('comm',v)} pre="$" result={fmtK(s.build.comm)}/>
        <Input label="ğŸ“ K-12 í•™êµ" value={s.build.school} onChange={v=>upd('school',v)} pre="$" result={fmtK(s.build.school)}/>
        <Input label="ğŸ”¬ ëŒ€í•™/ì—°êµ¬ì†Œ" value={s.build.uni} onChange={v=>upd('uni',v)} pre="$" result={fmtK(s.build.uni)}/>
        <Input label="ğŸŠ ìŠ¤í¬ì¸ /ìˆ˜ì˜ì¥" value={s.build.sports} onChange={v=>upd('sports',v)} pre="$" result={fmtK(s.build.sports)}/>
        <Input label="ğŸ“š ë„ì„œê´€" value={s.build.lib} onChange={v=>upd('lib',v)} pre="$" result={fmtK(s.build.lib)}/>
        <Input label="ğŸ­ ê·¹ì¥/ê³µì—°ì¥" value={s.build.theater} onChange={v=>upd('theater',v)} pre="$" result={fmtK(s.build.theater)}/>
        <Input label="ğŸ›’ ë§ˆì¼“í”Œë ˆì´ìŠ¤" value={s.build.market} onChange={v=>upd('market',v)} pre="$" result={fmtK(s.build.market)}/>
        <Input label="â›ª ì¢…êµì‹œì„¤" value={s.build.worship} onChange={v=>upd('worship',v)} pre="$" result={fmtK(s.build.worship)}/>
        <Input label="ğŸ‘¶ ì–´ë¦°ì´ì§‘" value={s.build.daycare} onChange={v=>upd('daycare',v)} pre="$" result={fmtK(s.build.daycare)}/>
        <Input label="ğŸ‘´ ì‹œë‹ˆì–´ì„¼í„°" value={s.build.senior} onChange={v=>upd('senior',v)} pre="$" result={fmtK(s.build.senior)}/>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ› ï¸ ì¸í”„ë¼</div><span className="badge badge-yellow">{fmtBoth(f.bldI)}</span></div>
      <div className="section-body">
        <Input label="ğŸ›£ï¸ ë„ë¡œë§" value={s.build.roads} onChange={v=>upd('roads',v)} pre="$" result={fmtK(s.build.roads)}/>
        <Input label="ğŸ’§ ìƒìˆ˜ë„" value={s.build.water} onChange={v=>upd('water',v)} pre="$" result={fmtK(s.build.water)}/>
        <Input label="ğŸš¿ í•˜ìˆ˜ë„" value={s.build.sewer} onChange={v=>upd('sewer',v)} pre="$" result={fmtK(s.build.sewer)}/>
        <Input label="âš¡ ì „ë ¥ë§" value={s.build.grid} onChange={v=>upd('grid',v)} pre="$" result={fmtK(s.build.grid)}/>
        <Input label="ğŸ“¡ í†µì‹ ë§" value={s.build.telecom} onChange={v=>upd('telecom',v)} pre="$" result={fmtK(s.build.telecom)}/>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸŒ¾ ë†ì—…/ì‹ëŸ‰<span className="eco-badge">ğŸŒ± ìê¸‰ìì¡±</span></div><span className="badge badge-green">{fmtBoth(f.bldA)}</span></div>
      <div className="section-body">
        <Input label="ğŸŒ± ì˜¨ì‹¤" value={s.build.gh} onChange={v=>upd('gh',v)} pre="$" result={fmtK(s.build.gh)}/>
        <Input label="ğŸ¤– ìŠ¤ë§ˆíŠ¸íŒœ" value={s.build.smart} onChange={v=>upd('smart',v)} pre="$" result={fmtK(s.build.smart)}/>
        <Input label="ğŸ„ ì¶•ì‚°ì‹œì„¤" value={s.build.live} onChange={v=>upd('live',v)} pre="$" result={fmtK(s.build.live)}/>
        <Input label="ğŸŸ ì–‘ì‹ì¥" value={s.build.fish} onChange={v=>upd('fish',v)} pre="$" result={fmtK(s.build.fish)}/>
        <Input label="ğŸª ì €ì¥ì°½ê³ " value={s.build.storage} onChange={v=>upd('storage',v)} pre="$" result={fmtK(s.build.storage)}/>
        <Input label="ğŸ­ ì‹í’ˆê°€ê³µ" value={s.build.proc} onChange={v=>upd('proc',v)} pre="$" result={fmtK(s.build.proc)}/>
      </div>
    </div>
  </div>;
};
const Energy=({s,setS,f})=>{
  const upd=(k,v)=>setS(p=>({...p,energy:{...p.energy,[k]:v}}));
  return<div>
    <div className="alert">ğŸŒ¿ 100% ì¬ìƒì—ë„ˆì§€: ì§€ì—´ + ìˆ˜ë ¥ + íƒœì–‘ê´‘ + í’ë ¥</div>
    <div className="stats">
      <Stat label="í•„ìš” ì „ë ¥" value={`${(f.eD.total/1000).toFixed(1)} MW`} color="red"/>
      <Stat label="ë°œì „ ìš©ëŸ‰" value={`${(f.eS/1000).toFixed(1)} MW`} color="green"/>
      <Stat label="ì‰ì—¬ ì „ë ¥" value={`${((f.eS-f.eD.total)/1000).toFixed(1)} MW`} color="blue"/>
      <Stat label="ì—ë„ˆì§€ íˆ¬ì" value={fmt(f.eC)} krw={fmtK(f.eC)} color="purple"/>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ“Š ì „ë ¥ ìˆ˜ìš”</div><span className="badge badge-red">{(f.eD.total/1000).toFixed(2)} MW</span></div>
      <div className="section-body">
        <h4 style={{fontSize:14,fontWeight:600,marginBottom:14,color:'var(--text2)'}}>ğŸ  ì£¼ê±° ì „ë ¥</h4>
        <Input label="Tier 1 ì„¸ëŒ€ë‹¹" value={s.energy.t1kw} onChange={v=>upd('t1kw',v)} suf="kW" result={`${s.mem.t1.n}ì„¸ëŒ€ = ${fmtN(f.eD.t1)} kW`}/>
        <Input label="Tier 2 ì„¸ëŒ€ë‹¹" value={s.energy.t2kw} onChange={v=>upd('t2kw',v)} suf="kW" result={`${s.mem.t2.n}ì„¸ëŒ€ = ${fmtN(f.eD.t2)} kW`}/>
        <Input label="Tier 3 ì„¸ëŒ€ë‹¹" value={s.energy.t3kw} onChange={v=>upd('t3kw',v)} suf="kW" result={`${s.mem.t3.n}ì„¸ëŒ€ = ${fmtN(f.eD.t3)} kW`}/>
        <div className="divider"></div>
        <h4 style={{fontSize:14,fontWeight:600,marginBottom:14,color:'var(--text2)'}}>ğŸ›ï¸ ê³µìš©/ê¸°ìˆ </h4>
        <Input label="ê³µìš©ì‹œì„¤" value={s.energy.commKw} onChange={v=>upd('commKw',v)} suf="kW"/>
        <Input label="ë°ì´í„°ì„¼í„°" value={s.energy.dcKw} onChange={v=>upd('dcKw',v)} suf="kW"/>
        <Input label="ë§ˆì´ë‹" value={s.energy.mineKw} onChange={v=>upd('mineKw',v)} suf="kW"/>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">âš¡ ë°œì „ ì„¤ë¹„<span className="eco-badge">ğŸŒ± 100% ê·¸ë¦°</span></div><span className="badge badge-green">{(f.eS/1000).toFixed(1)} MW</span></div>
      <div className="section-body">
        <Input label="ğŸŒ‹ ì§€ì—´ ìš©ëŸ‰" value={s.energy.geoMW} onChange={v=>upd('geoMW',v)} suf="MW" result={fmtBoth(s.energy.geoMW*s.energy.geoCostPerMW)}/>
        <Input label="ì§€ì—´ MWë‹¹ ë¹„ìš©" value={s.energy.geoCostPerMW} onChange={v=>upd('geoCostPerMW',v)} pre="$"/>
        <div className="divider"></div>
        <Input label="ğŸ’§ ìˆ˜ë ¥ ìš©ëŸ‰" value={s.energy.hydroMW} onChange={v=>upd('hydroMW',v)} suf="MW" result={fmtBoth(s.energy.hydroMW*s.energy.hydroCost)}/>
        <Input label="ìˆ˜ë ¥ MWë‹¹ ë¹„ìš©" value={s.energy.hydroCost} onChange={v=>upd('hydroCost',v)} pre="$"/>
        <div className="divider"></div>
        <Input label="â˜€ï¸ íƒœì–‘ê´‘ ìš©ëŸ‰" value={s.energy.solarMW} onChange={v=>upd('solarMW',v)} suf="MW" result={fmtBoth(s.energy.solarMW*s.energy.solarCost)}/>
        <Input label="íƒœì–‘ê´‘ MWë‹¹ ë¹„ìš©" value={s.energy.solarCost} onChange={v=>upd('solarCost',v)} pre="$"/>
        <div className="divider"></div>
        <Input label="ğŸŒ¬ï¸ í’ë ¥ ìš©ëŸ‰" value={s.energy.windMW} onChange={v=>upd('windMW',v)} suf="MW" result={fmtBoth(s.energy.windMW*s.energy.windCost)}/>
        <Input label="í’ë ¥ MWë‹¹ ë¹„ìš©" value={s.energy.windCost} onChange={v=>upd('windCost',v)} pre="$"/>
      </div>
    </div>
  </div>;
};

const Services=({s,setS,f})=>{
  const upd=(cat,k,v)=>setS(p=>({...p,staff:{...p.staff,[cat]:{...p.staff[cat],[k]:v}}}));
  const Sec=({title,icon,cat,fields,total,color='blue'})=><div className="section"><div className="section-header"><div className="section-title">{icon} {title}</div><span className={`badge badge-${color}`}>ì—° {fmt(total)}</span></div><div className="section-body">{fields.map(f=><Input key={f.k} label={f.l} value={s.staff[cat][f.k]} onChange={v=>upd(cat,f.k,v)} suf={f.s||''} pre={f.p||''}/>)}</div></div>;
  return<div>
    <div className="alert">ğŸ’¡ ì¸ê±´ë¹„ë§Œ ê´€ë¦¬í•©ë‹ˆë‹¤. ì¥ë¹„ ë¹„ìš©ì€ [ì§€ì¶œ] ë©”ë‰´ì—ì„œ ë³„ë„ ê´€ë¦¬ë©ë‹ˆë‹¤.</div>
    <div className="stats">
      <Stat label="ì—°ê°„ ì¸ê±´ë¹„" value={fmt(f.laborTotal)} krw={fmtK(f.laborTotal)} color="blue"/>
      <Stat label="ì›”ê°„ ì¸ê±´ë¹„" value={fmt(f.laborMonth)} krw={fmtK(f.laborMonth)} color="purple"/>
    </div>
    <Sec title="ë³´ì•ˆ" icon="ğŸ›¡ï¸" cat="security" total={f.laborYear.security} color="red" fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì˜ë£Œ" icon="ğŸ¥" cat="medical" total={f.laborYear.medical} color="blue" fields={[{k:'doc',l:'ì˜ì‚¬',s:'ëª…'},{k:'nur',l:'ê°„í˜¸ì‚¬',s:'ëª…'},{k:'docSal',l:'ì˜ì‚¬ì—°ë´‰',p:'$'},{k:'nurSal',l:'ê°„í˜¸ì‚¬ì—°ë´‰',p:'$'}]}/>
    <Sec title="êµìœ¡" icon="ğŸ“" cat="education" total={f.laborYear.education} color="purple" fields={[{k:'teach',l:'êµì‚¬',s:'ëª…'},{k:'prof',l:'êµìˆ˜',s:'ëª…'},{k:'tSal',l:'êµì‚¬ì—°ë´‰',p:'$'},{k:'pSal',l:'êµìˆ˜ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì‹ë‹¹" icon="ğŸ½ï¸" cat="dining" total={f.laborYear.dining} color="yellow" fields={[{k:'chef',l:'ì…°í”„',s:'ëª…'},{k:'staff',l:'ìŠ¤íƒ­',s:'ëª…'},{k:'sal',l:'í‰ê· ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì‹œì„¤ê´€ë¦¬" icon="ğŸ”§" cat="maintenance" total={f.laborYear.maintenance} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="í–‰ì •" icon="ğŸ“‹" cat="admin" total={f.laborYear.admin} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="IT" icon="ğŸ’»" cat="it" total={f.laborYear.it} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ê´€ì œ" icon="ğŸ“¡" cat="control" total={f.laborYear.control} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ë§ˆì´ë‹" icon="â›ï¸" cat="mining" total={f.laborYear.mining} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì¡°ê²½" icon="ğŸŒ³" cat="garden" total={f.laborYear.garden} color="green" fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="í”¼íŠ¸ë‹ˆìŠ¤" icon="ğŸ‹ï¸" cat="fitness" total={f.laborYear.fitness} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ë¯¸ìš©ì‹¤" icon="ğŸ’‡" cat="salon" total={f.laborYear.salon} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì»¨ì‹œì–´ì§€" icon="ğŸ›ï¸" cat="concierge" total={f.laborYear.concierge} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ìš´ì†¡" icon="ğŸš" cat="driver" total={f.laborYear.driver} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì²­ì†Œ" icon="ğŸ§¹" cat="cleaning" total={f.laborYear.cleaning} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì„¸íƒ" icon="ğŸ‘”" cat="laundry" total={f.laborYear.laundry} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ë†ì¥" icon="ğŸŒ¾" cat="farm" total={f.laborYear.farm} color="green" fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ì¶•ì‚°" icon="ğŸ„" cat="livestock" total={f.laborYear.livestock} color="green" fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
    <Sec title="ë¦¬í…Œì¼" icon="ğŸ›’" cat="retail" total={f.laborYear.retail} fields={[{k:'n',l:'ì¸ì›',s:'ëª…'},{k:'sal',l:'ì—°ë´‰',p:'$'}]}/>
  </div>;
};

const Tech=({s,setS,f,btc})=>{
  const updD=(k,v)=>setS(p=>({...p,dc:{...p.dc,[k]:v}}));
  const updM=(k,v)=>setS(p=>({...p,mine:{...p.mine,[k]:v}}));
  const updR=v=>setS(p=>({...p,res:{total:v}}));
  return<div>
    <div className="stats">
      <Stat label="ë°ì´í„°ì„¼í„°" value={fmt(f.dc)} krw={fmtK(f.dc)} color="purple"/>
      <Stat label="ë§ˆì´ë‹ íˆ¬ì" value={fmt(f.mineCost)} krw={fmtK(f.mineCost)} color="yellow"/>
      <Stat label="ë§ˆì´ë‹ ì—°ìˆ˜ìµ" value={fmt(f.mineRev.yearlyUSD)} krw={`${fmtBTC(f.mineRev.yearlyBTC)} BTC`} color="green"/>
      <Stat label="ë¹„ì¶•ê¸ˆ" value={fmt(f.res)} krw={fmtK(f.res)} color="red"/>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ–¥ï¸ ë°ì´í„°ì„¼í„°</div><span className="badge badge-purple">{fmtBoth(f.dc)}</span></div>
      <div className="section-body">
        <Input label="ì„œë²„" value={s.dc.srv} onChange={v=>updD('srv',v)} suf="ëŒ€"/>
        <Input label="ì„œë²„ë‹¹ ë¹„ìš©" value={s.dc.cost} onChange={v=>updD('cost',v)} pre="$" result={fmtBoth(s.dc.srv*s.dc.cost)}/>
        <Input label="ì¸í”„ë¼" value={s.dc.infra} onChange={v=>updD('infra',v)} pre="$" result={fmtK(s.dc.infra)}/>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">â›ï¸ ë§ˆì´ë‹</div><span className="badge badge-yellow"><span className="live-dot"></span>ì‹¤ì‹œê°„</span></div>
      <div className="section-body">
        <div className="btc-card">
          <div style={{display:'flex',alignItems:'center',justifyContent:'space-between',flexWrap:'wrap',gap:16}}>
            <div><div style={{fontSize:12,color:'var(--text2)',marginBottom:6}}><span className="live-dot"></span>BTC ì‹¤ì‹œê°„ ê°€ê²©</div><span className="btc-price">${fmtN(Math.round(btc.price))}</span><span className={`btc-change ${btc.change>=0?'up':'down'}`}>{btc.change>=0?'â–²':'â–¼'} {Math.abs(btc.change).toFixed(1)}%</span></div>
            <div style={{textAlign:'right'}}><div style={{fontSize:12,color:'var(--text2)',marginBottom:6}}>ë„¤íŠ¸ì›Œí¬ í•´ì‹œë ˆì´íŠ¸</div><div style={{fontSize:22,fontWeight:700,color:'#d97706'}}>{btc.networkHash.toFixed(2)} EH/s</div></div>
          </div>
        </div>
        <Input label="ì´ ë¦¬ê·¸ ìˆ˜" value={s.mine.rigs} onChange={v=>updM('rigs',v)} suf="ëŒ€"/>
        <Input label="ë¦¬ê·¸ë‹¹ ë¹„ìš©" value={s.mine.cost} onChange={v=>updM('cost',v)} pre="$"/>
        <Input label="ê°€ë™ ë¦¬ê·¸ ìˆ˜" value={s.mine.active} onChange={v=>updM('active',v)} suf="ëŒ€"/>
        <Input label="ë¦¬ê·¸ë‹¹ í•´ì‹œë ˆì´íŠ¸" value={s.mine.hashPerRig} onChange={v=>updM('hashPerRig',v)} suf="TH/s"/>
        <div className="divider"></div>
        <table><tbody>
          <tr><td>ê°€ë™ë¥ </td><td className="text-right font-bold">{fmtP(f.activeRate*100)}</td></tr>
          <tr><td>ì´ í•´ì‹œë ˆì´íŠ¸</td><td className="text-right font-bold">{fmtN(Math.round(f.mineRev.totalHashTH))} TH/s</td></tr>
          <tr style={{background:'#dcfce7'}}><td className="font-bold">ì—°ê°„ ì±„êµ´ ìˆ˜ìµ</td><td className="text-right font-bold text-green">{fmtBTC(f.mineRev.yearlyBTC)} BTC â‰ˆ {fmtBoth(f.mineRev.yearlyUSD)}</td></tr>
        </tbody></table>
      </div>
    </div>
    <div className="section"><div className="section-header"><div className="section-title">ğŸ¦ ë¹„ì¶•ê¸ˆ</div><span className="badge badge-red">{fmtBoth(f.res)}</span></div>
      <div className="section-body"><Input label="ë¹„ì¶•ê¸ˆ ì´ì•¡" value={s.res.total} onChange={updR} pre="$" result={fmtK(s.res.total)}/></div>
    </div>
  </div>;
};
function App(){
  const[s,setS]=useState(D);
  const[page,setPage]=useState('dashboard');
  const[toast,setToast]=useState('');
  const[btc,setBtc]=useState({price:101000,change:2.4,networkHash:750});
  const[isOnline,setIsOnline]=useState(true);
  const[loading,setLoading]=useState(true);
  
  // Firebaseì—ì„œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
  useEffect(()=>{
    const dataRef=db.ref('novaark-data');
    
    // ì‹¤ì‹œê°„ ë¦¬ìŠ¤ë„ˆ
    dataRef.on('value',(snapshot)=>{
      const data=snapshot.val();
      if(data){
        setS(data);
        setIsOnline(true);
      }
      setLoading(false);
    },(error)=>{
      console.error('Firebase error:',error);
      setIsOnline(false);
      setLoading(false);
      // ì˜¤í”„ë¼ì¸ì´ë©´ localStorageì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸°
      try{
        const local=localStorage.getItem('nova_ark_v12');
        if(local)setS(JSON.parse(local));
      }catch(e){}
    });
    
    // ì—°ê²° ìƒíƒœ ëª¨ë‹ˆí„°ë§
    const connRef=db.ref('.info/connected');
    connRef.on('value',(snap)=>{
      setIsOnline(snap.val()===true);
    });
    
    return()=>{
      dataRef.off();
      connRef.off();
    };
  },[]);
  
  // BTC ê°€ê²© ì‹¤ì‹œê°„
  useEffect(()=>{
    const fetchBtc=async()=>{
      try{
        const[priceRes,hashRes]=await Promise.all([
          fetch('https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd&include_24hr_change=true'),
          fetch('https://blockchain.info/q/hashrate')
        ]);
        const d=await priceRes.json();
        const hashTHs=await hashRes.text();
        const networkEH=parseFloat(hashTHs)/1e6;
        if(d.bitcoin){setBtc(p=>({...p,price:d.bitcoin.usd,change:d.bitcoin.usd_24h_change||0,networkHash:networkEH||750}));}
      }catch(e){}
    };
    fetchBtc();
    const i=setInterval(fetchBtc,60000);
    return()=>clearInterval(i);
  },[]);
  
  const f=useMemo(()=>calc(s,btc),[s,btc]);
  const showToast=m=>{setToast(m);setTimeout(()=>setToast(''),2000);};
  
  // Firebaseì— ì €ì¥
  const save=()=>{
    try{
      db.ref('novaark-data').set(s);
      localStorage.setItem('nova_ark_v12',JSON.stringify(s));
      showToast('ğŸ’¾ ì„œë²„ì— ì €ì¥ë¨!');
    }catch(e){
      // Firebase ì‹¤íŒ¨ì‹œ ë¡œì»¬ì—ë§Œ ì €ì¥
      localStorage.setItem('nova_ark_v12',JSON.stringify(s));
      showToast('ğŸ’¾ ë¡œì»¬ì— ì €ì¥ë¨ (ì˜¤í”„ë¼ì¸)');
    }
  };
  
  const reset=()=>{
    if(confirm('ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ëª¨ë“  ë°ì´í„°ê°€ ê¸°ë³¸ê°’ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.')){
      db.ref('novaark-data').set(D);
      localStorage.removeItem('nova_ark_v12');
      setS(D);
      showToast('ğŸ”„ ì´ˆê¸°í™” ì™„ë£Œ!');
    }
  };
  
  const titles={dashboard:'ëŒ€ì‹œë³´ë“œ',income:'ìˆ˜ì…',expense:'ì§€ì¶œ',membership:'ë©¤ë²„ì‹­',construction:'ê±´ì¶•',energy:'ì—ë„ˆì§€',services:'ì„œë¹„ìŠ¤/ì¸ë ¥',tech:'ê¸°ìˆ '};
  const icons={dashboard:'ğŸ“Š',income:'ğŸ’°',expense:'ğŸ’¸',membership:'ğŸ‘¥',construction:'ğŸ—ï¸',energy:'âš¡',services:'ğŸ¥',tech:'ğŸ–¥ï¸'};
  const render=()=>{
    const p={s,setS,f,btc};
    switch(page){
      case'income':return<Income {...p}/>;
      case'expense':return<Expense {...p}/>;
      case'membership':return<Membership {...p}/>;
      case'construction':return<Construction {...p}/>;
      case'energy':return<Energy {...p}/>;
      case'services':return<Services {...p}/>;
      case'tech':return<Tech {...p}/>;
      default:return<Dashboard {...p}/>;
    }
  };
  
  if(loading)return<div style={{display:'flex',alignItems:'center',justifyContent:'center',height:'100vh',background:'linear-gradient(135deg,#f0f7f4,#d8f3dc)'}}><div style={{textAlign:'center'}}><div style={{fontSize:48,marginBottom:16}}>ğŸŒ¿</div><div style={{color:'#2d6a4f',fontWeight:600}}>ë¡œë”© ì¤‘...</div></div></div>;
  
  return<div className="app">
    <Sidebar page={page} setPage={setPage} isOnline={isOnline}/>
    <div className="main">
      <div className="topbar"><div className="page-title"><span>{icons[page]}</span>{titles[page]}<span className="eco-badge">ğŸŒ± Smart Green City</span></div></div>
      <div className="save-bar">
        <button className="save-btn primary" onClick={save}>ğŸ’¾ ì €ì¥ {isOnline?'(ì„œë²„)':'(ë¡œì»¬)'}</button>
        <button className="save-btn danger" onClick={reset}>ğŸ”„ ì´ˆê¸°í™”</button>
      </div>
      <div className="content">{render()}</div>
    </div>
    <div className="widget"><h4>ğŸŒ¿ ì‹¤ì‹œê°„ ìš”ì•½</h4>
      <div className="widget-row"><span>ìˆœìˆ˜ì…</span><span style={{color:'#52b788'}}>{fmt(f.net)}</span></div>
      <div className="widget-row"><span>ì´ì§€ì¶œ</span><span style={{color:'#ef4444'}}>{fmt(f.totalExp)}</span></div>
      <div className="widget-row total"><span>ì‰ì—¬ê¸ˆ</span><span style={{color:f.bal>=0?'#52b788':'#ef4444'}}>{fmt(f.bal)}</span></div>
      <div className="widget-krw">{fmtK(f.bal)}</div>
      <div className="sync-status" style={{marginTop:12,paddingTop:10,borderTop:'1px solid rgba(255,255,255,0.2)'}}><span className={`sync-dot ${isOnline?'':'offline'}`}></span>{isOnline?'ì„œë²„ ë™ê¸°í™”ë¨':'ì˜¤í”„ë¼ì¸ ëª¨ë“œ'}</div>
    </div>
    {toast&&<div className="toast">{toast}</div>}
  </div>;
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
